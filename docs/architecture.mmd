%%{init: {"theme":"default","themeVariables":{"fontSize":"16px","fontFamily":"Inter, Arial, sans-serif","primaryTextColor":"#111","lineColor":"#374151","tertiaryColor":"#eef2ff"},"flowchart":{"htmlLabels":true,"curve":"basis","nodeSpacing":100,"rankSpacing":100}}}%%
flowchart TB
  %% Cliente
  subgraph Client["ğŸŒ Camada de ApresentaÃ§Ã£o"]
    direction LR
    web["<b>Web Client</b><br/>React + Vite<br/>TanStack Query<br/>Zustand"]
  end

  %% Gateway
  subgraph Gateway["âš¡ API Gateway"]
    gw["<b>NestJS Gateway</b><br/>:3000<br/>â”â”â”â”â”â”â”â”â”â”<br/>â€¢ Rate Limiting<br/>â€¢ JWT Validation<br/>â€¢ Request Routing"]
  end

  %% ServiÃ§os
  subgraph Services["ğŸ”· MicroserviÃ§os (NestJS)"]
    direction TB
    
    subgraph AuthService["ServiÃ§o de AutenticaÃ§Ã£o"]
      auth["<b>Auth Service</b><br/>:3001<br/>â”â”â”â”â”â”â”â”â”â”<br/>â€¢ Login/Register<br/>â€¢ JWT Tokens<br/>â€¢ User Management"]
    end
    
    subgraph TasksService["ServiÃ§o de Tarefas"]
      tasks["<b>Tasks Service</b><br/>:3002<br/>â”â”â”â”â”â”â”â”â”â”<br/>â€¢ CRUD Tarefas<br/>â€¢ ValidaÃ§Ã£o<br/>â€¢ Event Publisher"]
    end
    
    subgraph NotifsService["ServiÃ§o de NotificaÃ§Ãµes"]
      notifs["<b>Notifications Service</b><br/>:3003<br/>â”â”â”â”â”â”â”â”â”â”<br/>â€¢ WebSocket Server<br/>â€¢ Event Consumer<br/>â€¢ Push Notifications"]
    end
  end

  %% Infraestrutura
  subgraph Infra["ğŸ’¾ Camada de Dados"]
    direction LR
    db[("<b>PostgreSQL</b><br/>:5432<br/>â”â”â”â”â”â”â”â”â”â”<br/>â€¢ users<br/>â€¢ tasks<br/>â€¢ notifications")]
    mq[("<b>RabbitMQ</b><br/>:5672<br/>â”â”â”â”â”â”â”â”â”â”<br/><i>Exchange:</i> tasks.events<br/><i>Routing:</i> task.#<br/><i>Queue:</i> notifications")]
  end

  %% ConexÃµes Cliente -> Gateway
  web -->|"â‘  HTTP/HTTPS<br/>Authorization: Bearer JWT"| gw
  web <-.->|"â‘¥ WebSocket<br/>Real-time updates"| notifs

  %% ConexÃµes Gateway -> ServiÃ§os
  gw -->|"â‘¡ HTTP + JWT<br/>/api/auth/**"| auth
  gw -->|"â‘¢ HTTP + JWT<br/>/api/tasks/**"| tasks
  gw -->|"â‘£ HTTP + JWT<br/>/api/notifications/**"| notifs

  %% ServiÃ§os -> Banco de Dados
  auth -->|"SQL Queries"| db
  tasks -->|"SQL Queries"| db
  notifs -->|"SQL Queries"| db

  %% Message Queue
  tasks -.->|"â‘¤ AMQP Publish<br/>task.created<br/>task.updated<br/>task.deleted"| mq
  mq -.->|"AMQP Consume<br/>Auto-ack"| notifs

  %% Legenda
  subgraph Legend["ğŸ“‹ Legenda"]
    direction LR
    sync["â”â” SÃ­ncrono (HTTP)"]
    async["â”„â”„ AssÃ­ncrono (AMQP/WS)"]
  end

  %% Styling
  classDef gateway fill:#e0e7ff,stroke:#4f46e5,color:#111,stroke-width:2px;
  classDef service fill:#cffafe,stroke:#0e7490,color:#111,stroke-width:2px;
  classDef infra fill:#fef3c7,stroke:#d97706,color:#111,stroke-width:2px;
  classDef client fill:#dcfce7,stroke:#16a34a,color:#111,stroke-width:2px;
  classDef legend fill:#f3f4f6,stroke:#6b7280,color:#111,stroke-width:1px;

  class gw gateway;
  class auth,tasks,notifs service;
  class db,mq infra;
  class web client;
  class sync,async legend;